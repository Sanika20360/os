package com.programming;
import java.util.Scanner;
import java.util.Arrays;
import java.util.ArrayList;

public class DeadlockDetectionAlgo
{
    public static void main(String[] args)
    {
        ArrayList<Integer> safeSequence = new ArrayList<>();
        Scanner scanner = new Scanner(System.in);
        System.out.println("Enter total number of processes:");
        int totalNumberOfProcesses = scanner.nextInt();
        System.out.println("Enter total type of resources:");
        int totalTypesOfResources = scanner.nextInt();
        int[][] allocatedMatrix = new int[totalNumberOfProcesses][totalTypesOfResources+1];
        for(int i = 0 ; i<totalNumberOfProcesses;i++)
        {
            System.out.println("Enter process Id:");
            allocatedMatrix[i][0] = scanner.nextInt();
            for(int j = 1 ; j <= totalTypesOfResources ; j++)
            {
                System.out.println("For process with Id "+allocatedMatrix[i][0]+", enter allocated instance of R"+(j-1)+":");
                allocatedMatrix[i][j] = scanner.nextInt();
            }
        }



        int[][] requested = new int[totalNumberOfProcesses][totalTypesOfResources+1];
        for(int i = 0 ; i < totalNumberOfProcesses ; i++)
        {
            requested[i][0] = allocatedMatrix[i][0];
            for(int j = 1 ; j <= totalTypesOfResources ; j++)
            {
                System.out.println("For process with Id "+allocatedMatrix[i][0]+", enter requested instance of R"+j+":");
                requested[i][j] = scanner.nextInt();
            }
        }

        int[] totalResources =  new int[totalTypesOfResources];
        for(int i = 0 ; i< totalTypesOfResources;i++)
        {
            System.out.println("Enter total resources of R"+i+":");
            totalResources[i] = scanner.nextInt();
        }


        int[] allocated = new int[totalTypesOfResources];

        //Calculate allocated
        for(int[] row:allocatedMatrix)
        {
            for(int i = 1; i <= totalTypesOfResources;i++)
            {
                allocated[i-1] += row[i];
            }
        }

        int[] available = new int[totalTypesOfResources];
        for(int i = 0 ; i < totalTypesOfResources ;i++)
        {
            available[i] = totalResources[i] - allocated[i];
        }

        boolean[] finish = new boolean[totalNumberOfProcesses];

        System.out.println("Allocated Matrix:");
        for(int[] element:allocatedMatrix)
            System.out.println(Arrays.toString(element));

        System.out.println("Requested Matrix:");
        for(int[] element:requested)
            System.out.println(Arrays.toString(element));

        System.out.println("Total resources:"+Arrays.toString(totalResources));

        System.out.println("Allocated Resources:"+Arrays.toString(allocated));

        System.out.println("Available Resources:"+Arrays.toString(available));

        boolean flag;
        for(int i = 0 ; i < totalNumberOfProcesses ; i++)
        {
            flag = false;
            for(int j = 1 ; j <= totalTypesOfResources ;j++)
            {
                if(allocatedMatrix[i][j]!=0)
                {
                    flag = true;
                    break;
                }
            }
            if(flag)
                finish[i] = false;
            else
                finish[i] = true;
        }

        flag = true;
        boolean flag2 = true;
        while(flag)
        {
            flag = false;
            for(int i = 0 ; i < totalNumberOfProcesses ; i++)
            {
                if(!finish[i])
                {
                    for (int j = 1; j <= totalTypesOfResources; j++)
                    {
                        if (requested[i][j] <= available[j - 1])
                            flag2 = true;
                        else
                        {
                            flag2 = false;
                            break;
                        }
                    }
                    if (flag2)
                    {
                        flag = true;
                        for (int j = 0 ; j < totalTypesOfResources ; j++)
                            available[j] += allocatedMatrix[i][j+1];
                        finish[i] = true;
                        System.out.println("Completed execution of process with Id "+requested[i][0]+".Available Now:"+Arrays.toString(available));
                        safeSequence.add(requested[i][0]);
                    }
                }
            }
        }

        for(boolean element:finish)
        {
            if(!element)
            {
                System.out.println("The system is in deadlock.Processes that are in deadlock are:-");
                for(int[] row:requested)
                {
                    if(!safeSequence.contains(row[0]))
                        System.out.println(row[0]);
                }
                System.out.println("Finish:"+Arrays.toString(finish));
                System.exit(1);
            }
        }

        System.out.println("The system is in safe state.Safe sequence:"+safeSequence);
        
    }
}

cprog
#include <stdio.h>  
#define MAX_PROCESSES 10  
#define MAX_RESOURCES 10  
  
int allocation[MAX_PROCESSES][MAX_RESOURCES];  
int request[MAX_PROCESSES][MAX_RESOURCES];  
int available[MAX_RESOURCES];  
int resources[MAX_RESOURCES];  
int work[MAX_RESOURCES];  
int marked[MAX_PROCESSES];  
  
int main() {  
 int num_processes, num_resources;  
  
 printf("Enter the number of processes: ");  
 scanf("%d", &num_processes);  
  
 printf("Enter the number of resources: ");  
 scanf("%d", &num_resources);  
  
 // Input total resources  
 for (int i = 0; i < num_resources; i++) {  
 printf("Enter the total amount of Resource R%d: ", i + 1);  
 scanf("%d", &resources[i]);  
 }  
  
 // Input request matrix  
 printf("Enter the request matrix:\n");  
 for (int i = 0; i < num_processes; i++) {  
 for (int j = 0; j < num_resources; j++) {  
 scanf("%d", &request[i][j]);  
 }  
 }  
  
 // User Input allocation matrix  
 printf("Enter the allocation matrix:\n");  
 for (int i = 0; i < num_processes; i++) {  
 for (int j = 0; j < num_resources; j++) {  
 scanf("%d", &allocation[i][j]);  
 }  
 }  
  
 // Initialization of the available resources  
 for (int j = 0; j < num_resources; j++) {  
 available[j] = resources[j];  
 for (int i = 0; i < num_processes; i++) {  
 available[j] -= allocation[i][j];  
 }  
 }  
  
 // Mark processes with zero allocation  
 for (int i = 0; i < num_processes; i++) {  
 int count = 0;  
 for (int j = 0; j < num_resources; j++) {  
 if (allocation[i][j] == 0) {  
 count++;  
 } else {  
 break;  
 }  
 }  
 if (count == num_resources) {  
 marked[i] = 1;  
 }  
 }  
  
 // Initialize work with available  
 for (int j = 0; j < num_resources; j++) {  
 work[j] = available[j];  
 }  
  
 // Mark processes with requests <= work  
 for (int i = 0; i < num_processes; i++) {  
 int can_be_processed = 1;  
 if (marked[i] != 1) {  
 for (int j = 0; j < num_resources; j++) {  
 if (request[i][j] > work[j]) {  
 can_be_processed = 0;  
 break;  
 }  
 }  
 if (can_be_processed) {  
 marked[i] = 1;  
 for (int j = 0; j < num_resources; j++) {  
 work[j] += allocation[i][j];  
 }  
 }  
 }  
 }  
  
 // Check for unmarked processes (deadlock)  
 int deadlock = 0;  
 for (int i = 0; i < num_processes; i++) {  
 if (marked[i] != 1) {  
 deadlock = 1;  
 break;  
 }  
 }  
  
 if (deadlock) {  
 printf("Deadlock detected\n");  
 } else {  
 printf("No deadlock possible\n");  
 }  
  
 return 0;  
}  
